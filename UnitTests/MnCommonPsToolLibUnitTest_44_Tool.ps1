#!/usr/bin/env pwsh

Import-Module -NoClobber -Name "MnCommonPsToolLib.psm1"; Set-StrictMode -Version Latest; trap [Exception] { StdErrHandleExc $_; break; }

function UnitTest_Tool(){
  OutProgress (ScriptGetCurrentFuncName);
  if( "TEST_THIS_IS_NOT_NESSESSARY" -eq "" ){  ToolTailFile "./anyfile.log"; }
  if( "TEST_THIS_IS_NOT_NESSESSARY" -eq "" ){  ToolAddLineToConfigFile "./myconfigfile.cfg" "MyVar=`"MyValue`"; # AUTOGENERATED-DO-NOT-CHANGE"; }
  ToolGithubApiAssertValidRepoUrl "https://github.com/mniederw/MnCommonPsToolLib/";
  try{
    ToolGithubApiListOrgRepos "TheAlgorithms"  | Where-Object{ -not $_.archived -and -not $_.private } |
      Select-Object Url, default_branch, fork, forks, language, CreatedAt, UpdatedAt, PermAdm, PermPush, PermPull, LicName, Description -First 3;
    [String] $tmpDir = ToolGithubApiDownloadLatestReleaseDir "https://github.com/mniederw/MnCommonPsToolLib/"; Assert ($tmpDir.Length -gt 5);
  }catch{ # Response status code does not indicate success: 403 (rate limit exceeded).
    if( -not $_.Exception.Message.Contains("403 (rate limit exceeded)") ){ throw; }
    OutWarning "Warning: Ignored: $_.Exception.Message";
  }
  if( "TEST_THIS_IS_NOT_NESSESSARY" -eq "" ){ Assert (FileExists (ToolEvalVsCodeExec)); }
}
UnitTest_Tool;
